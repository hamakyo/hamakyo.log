### AI自動タグ付け機能 実装計画書

Notion同期スクリプトに生成AIを組み込み、記事のタグを自動で生成する機能の実装計画を立てる。

#### 1. 目的
- **工数削減**: Notionで記事を執筆する際に、手動でタグを考える手間をなくす。
- **品質向上**: AIの客観的な判断に基づき、記事内容に適した一貫性のあるタグを付与する。
- **情報発見性の向上**: 適切なタグ付けにより、読者が関連性の高い記事を見つけやすくする。

#### 2. 新しいワークフローの提案
現在のNotion同期プロセスに、以下のステップを追加する。

1. GitHub Actionsが `sync-notion.ts` を実行
2. Notionから記事データを取得
3. **(新規) 記事のタイトルと本文を生成AIに送信**
4. **(新規) AIが内容を分析し、最適なタグのリストを返す**
5. 取得した記事データと**AIが生成したタグ**を基にMarkdownファイルを生成
6. `src/content/blog/` にファイルを保存

#### 3. 技術選定
- **AIモデル**: **Google AI (Gemini)** または **OpenAI (GPT-4oなど)** を利用する。どちらも高性能なAPIを提供しており、プロンプトに応じて高品質なタグを生成できる。
- **APIクライアント**: 公式のNode.jsライブラリ（`@google/generative-ai` や `openai`）を使用して、TypeScriptのスクリプトから安全にAPIを呼び出す。
- **APIキー管理**: APIキーは `.env` ファイルに保存し、Gitの管理対象から除外する。GitHub Actionsで実行する際は、リポジトリのSecrets機能を利用して安全にキーを渡す。

#### 4. 実装の詳細
- **プロンプト設計**:
  - AIへの指示（プロンプト）は、役割、記事内容、制約条件、出力形式を明確に定義する。
  - **例**:
    ```
    あなたは技術ブログの優秀な編集者です。
    以下の記事内容に最も関連性の高い技術的なタグを3つ、日本語で提案してください。
    タグは必ず配列形式（例: ["タグ1", "タグ2", "タグ3"]）で出力してください。

    # 記事タイトル:
    {記事のタイトル}

    # 記事本文:
    {記事の本文}
    ```
- **スクリプトの修正**:
  - `scripts/utils/` に `ai-tag-generator.ts` を新規作成し、AIとの通信ロジックをここに集約する。
  - `scripts/sync-notion.ts` から `ai-tag-generator.ts` を呼び出し、返ってきたタグをMarkdownのフロントマターに追加する処理を実装する。
  - `.env.example` に `GOOGLE_API_KEY` または `OPENAI_API_KEY` の項目を追加する。
  - `.github/workflows/sync-notion.yml` を修正し、GitHub SecretsからAPIキーを環境変数としてスクリプトに渡す設定を追加する。
- **エラーハンドリング**:
  - AIのAPI呼び出しが失敗した場合や、予期せぬ形式の応答があった場合は、エラーをログに記録し、タグを付けずに処理を続行する。これにより、タグ付け機能の障害が記事全体の同期を妨げないようにする。

#### 5. タスク分割
1. **[準備]** 使用するAI（Google AIまたはOpenAI）を決定し、APIキーを取得する。
2. **[環境設定]** `.env`ファイルにAPIキーを設定し、`.gitignore`に含まれていることを確認する。
3. **[実装]** `ai-tag-generator.ts` を作成し、AIにリクエストを送信してタグ候補を受け取る関数を実装する。
4. **[統合]** `sync-notion.ts` を修正し、`ai-tag-generator.ts`を呼び出して、生成されたタグをフロントマターに追加する処理を実装する。
5. **[CI/CD]** `sync-notion.yml` を更新し、GitHub Actions実行時にAPIキーを渡す設定を追加する。
6. **[テスト]** Notionに新しい記事（下書き）を作成し、`sync-notion`スクリプトを実行して、タグが自動で付与されたMarkdownファイルが生成されることを確認する。

#### 6. 費用に関する考慮事項
- AIのAPIは使用量に応じて費用が発生するが、テキスト生成のコストは比較的安価である。
- 例えば、月に10本の記事を同期する場合でも、APIの無料枠に収まるか、発生しても月額数十円〜数百円程度に収まる見込みである。